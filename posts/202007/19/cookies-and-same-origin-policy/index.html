<!DOCTYPE html>
<html lang="en"><head>
    





<title>クッキーの挙動は Same Origin Policy に従う…わけではない | 発火後忘失</title>

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content='次のQiitaのコメントを見て、そうなんだ、となりました: Auth TokenをlocalStorageに入れようが、cookieに入れようがどっち'>
<meta name="keywords" content=''>
<meta name="msapplication-TileColor" content="#b91d47">
<meta name="theme-color" content="#ffffff">

<link rel="canonical" href="https://yukihane.github.io/posts/202007/19/cookies-and-same-origin-policy/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#007aa6">
<meta name="theme-color" content="#ffffff">

<meta property="og:title" content="クッキーの挙動は Same Origin Policy に従う…わけではない" />
<meta property="og:description" content="次のQiitaのコメントを見て、そうなんだ、となりました: Auth TokenをlocalStorageに入れようが、cookieに入れようがどっち" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yukihane.github.io/posts/202007/19/cookies-and-same-origin-policy/" />
<meta property="article:published_time" content="2020-07-19T11:59:29+00:00" />
<meta property="article:modified_time" content="2020-07-19T11:59:29+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="クッキーの挙動は Same Origin Policy に従う…わけではない"/>
<meta name="twitter:description" content="次のQiitaのコメントを見て、そうなんだ、となりました: Auth TokenをlocalStorageに入れようが、cookieに入れようがどっち"/>

<meta itemprop="name" content="">
<meta itemprop="description" content="">
    
    
    
    
    
    <link rel="stylesheet" href='https://yukihane.github.io/css/style.css'>

    


<link href="https://fonts.googleapis.com/css?family=Hanuman:400,700|Inconsolata|Roboto:400,400i,700,700i&display=swap&subset=khmer" rel="stylesheet">
</head><body><header id="navigation" class="p-navigation">
    <div class="p-navigation__row">
        <div class="p-navigation__banner">
            <div class="p-navigation__logo">
                <a class="p-navigation__link u-vertically-center p-link--logo" href="https://yukihane.github.io/">
                    発火後忘失
                </a>
            </div>
            
            <a href="#navigation" class="p-navigation__toggle--open" title="menu">
                <i class="p-icon--menu"></i>
            </a>
            <a href="#navigation-closed" class="p-navigation__toggle--close" title="close menu">
                <i class="p-icon--close"></i>
            </a>
        </div>

        <nav class="p-navigation__nav">
            <span class="u-off-screen">
                <a href="#main-content">Jump to main content</a>
            </span>

            <ul class="p-navigation__links" role="menu">
                
            </ul>

            
            <form class="p-search-box" action="https://www.google.com/search" target="_blank">
    <input type="search" class="p-search-box__input" name="q" placeholder='Search'
        required="" aria-label="Query">
    <input type="hidden" name="sitesearch" value="https://yukihane.github.io/">
    <button type="reset" class="p-search-box__reset" alt="reset" aria-label="Reset">
        <i class="p-icon--close"></i>
    </button>
    <button type="submit" class="p-search-box__button" alt="search" aria-label="Search">
        <i class="p-icon--search"></i>
    </button>
</form>
            
        </nav>
    </div>
</header><div id="main-content">
<header class="p-strip page-banner">
    <div class="row">
        <h1>クッキーの挙動は Same Origin Policy に従う…わけではない</h1>
    </div>

    

<div class="row">

    
    <div class="col-8">
        




<div class="p-media-object">

    

    <div class="p-media-object__details">

        

        
        <p class="p-media-object__content">
            <span class="u-capitalized">on</span>
            2020-07-19
        </p>
        

    </div>
</div>


    </div>
    

    
    <div class="col-4  col--share-links ">
        <ul class="p-inline-list-icons p-inline-list-icons--share-links u-no-padding--left u-no-margin--left u-unselectable">
    <li class="p-inline-list__item">
        <i class="p-icon--share"></i>
    </li>
    <li class="p-inline-list__item">
        <a class="p-icon--facebook" title='Share on Facebook' target="_blank"
            rel="noreferrer" href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fyukihane.github.io%2fposts%2f202007%2f19%2fcookies-and-same-origin-policy%2f">
            Facebook
        </a>
    </li>
    <li class="p-inline-list__item">
        <a class="p-icon--twitter" title='Share on Twitter' target="_blank"
            rel="noreferrer" href="http://twitter.com/share?text=%e3%82%af%e3%83%83%e3%82%ad%e3%83%bc%e3%81%ae%e6%8c%99%e5%8b%95%e3%81%af%20Same%20Origin%20Policy%20%e3%81%ab%e5%be%93%e3%81%86%e2%80%a6%e3%82%8f%e3%81%91%e3%81%a7%e3%81%af%e3%81%aa%e3%81%84&amp;url=https%3a%2f%2fyukihane.github.io%2fposts%2f202007%2f19%2fcookies-and-same-origin-policy%2f">
            Twitter
        </a>
    </li>
    <li class="p-inline-list__item">
        <a class="p-icon--linkedin" title='Share on LinkedIn' target="_blank"
            rel="noreferrer"
            href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fyukihane.github.io%2fposts%2f202007%2f19%2fcookies-and-same-origin-policy%2f&amp;title=%e3%82%af%e3%83%83%e3%82%ad%e3%83%bc%e3%81%ae%e6%8c%99%e5%8b%95%e3%81%af%20Same%20Origin%20Policy%20%e3%81%ab%e5%be%93%e3%81%86%e2%80%a6%e3%82%8f%e3%81%91%e3%81%a7%e3%81%af%e3%81%aa%e3%81%84">
            LinkedIn
        </a>
    </li>
</ul>
    </div>
    

</div>




</header>

<section class="p-strip is-shallow">
    <main class="row post-content">
        <div class="paragraph">
<p>次のQiitaのコメントを見て、そうなんだ、となりました:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://qiita.com/github0013@github/items/e57c452de28f3918bf05#comment-4df8a971cd5c8c2d0673">Auth TokenをlocalStorageに入れようが、cookieに入れようがどっちもXSS危険性には無防備（同ドメイン内なら &#8230;&#8203;）</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>根拠を探してみたところ、同じくQiitaの記事</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://qiita.com/kubocchi/items/020352173d014cbf5332#%E5%95%8F2">君はできるかな？Cookie ＆ Same Origin Policyセキュリティークイズ4問</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>の出典として <a href="https://tools.ietf.org/html/rfc6265">RFC6265 HTTP State Management Mechanism</a>が挙げられており、そちらのドキュメントの冒頭にバッチリ書いてありました:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(前略)Similarly, cookies for a given host are shared across all the ports on that host, even though the usual "same-origin policy" used by web browsers isolates content retrieved via different ports.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; <a href="https://tools.ietf.org/html/rfc6265#section-1">1. Introduction</a>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cookies do not provide isolation by port.  If a cookie is readable by
   a service running on one port, the cookie is also readable by a
   service running on another port of the same server.  If a cookie is
   writable by a service on one port, the cookie is also writable by a
   service running on another port of the same server.  For this reason,
   servers SHOULD NOT both run mutually distrusting services on
   different ports of the same host and use cookies to store security-
   sensitive information.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; <a href="https://tools.ietf.org/html/rfc6265#section-8.5">8.5. Weak Confidentiality</a>
</div>
</div>
<div class="paragraph">
<p>ちなみに後続の文章ではスキーマ(<code>http</code> とか)が違っても送信されるよ、と書いてありまして、そういやその問題を抑制する方策のひとつとして <code>secure</code> があるのだな、と。</p>
</div>
<div class="paragraph">
<p>逆に言えば、 <code>secure</code> 属性みたいなのが必要ってことはcookiesはsame-origin-policyに従っているわけではないのだな、という推測が可能ですね。</p>
</div>

    </main>
</section>

<footer class="p-strip is-wrapper">
    <div class="row">
        <div class="p-article-pagination">
    
    <a class="p-article-pagination__link--previous" href="https://yukihane.github.io/posts/202007/19/use-git-pull-ff-only/">
        <span class="p-article-pagination__label">Previous</span>
        <span class="p-article-pagination__title">
            `git config pull.ff only` を設定しておこう
        </span>
    </a>
    

    
</div>
    </div>
</footer>

        </div><footer class="p-strip is-shallow page-footer">
    <div class="row">
        <div class="col-12  u-align--center">
            <p>
                © 2020 発火後忘失
            </p>
        </div>
    </div>
</footer>




</body>
</html>
