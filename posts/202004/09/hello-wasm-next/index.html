<!DOCTYPE html>
<html lang="en"><head>
    





<title>rustでwasmでhello, world(2020-04-08版) の次 | 発火後忘失</title>

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content='目標 rust で wasm で hello, worldの次として、JavaScript で実装されたプロジェクトを Rust に書き直してみます。 最近N 予備校のプログラミング入門 Web ア'>
<meta name="keywords" content='rust, wasm'>
<meta name="msapplication-TileColor" content="#b91d47">
<meta name="theme-color" content="#ffffff">

<link rel="canonical" href="https://yukihane.github.io/posts/202004/09/hello-wasm-next/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#007aa6">
<meta name="theme-color" content="#ffffff">

<meta property="og:title" content="rustでwasmでhello, world(2020-04-08版) の次" />
<meta property="og:description" content="目標 rust で wasm で hello, worldの次として、JavaScript で実装されたプロジェクトを Rust に書き直してみます。 最近N 予備校のプログラミング入門 Web ア" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yukihane.github.io/posts/202004/09/hello-wasm-next/" />
<meta property="article:published_time" content="2020-04-09T20:52:10+00:00" />
<meta property="article:modified_time" content="2020-04-09T20:52:10+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="rustでwasmでhello, world(2020-04-08版) の次"/>
<meta name="twitter:description" content="目標 rust で wasm で hello, worldの次として、JavaScript で実装されたプロジェクトを Rust に書き直してみます。 最近N 予備校のプログラミング入門 Web ア"/>

<meta itemprop="name" content="">
<meta itemprop="description" content="">
    
    
    
    
    
    <link rel="stylesheet" href='https://yukihane.github.io/css/style.css'>

    


<link href="https://fonts.googleapis.com/css?family=Hanuman:400,700|Inconsolata|Roboto:400,400i,700,700i&display=swap&subset=khmer" rel="stylesheet">
</head><body><header id="navigation" class="p-navigation">
    <div class="p-navigation__row">
        <div class="p-navigation__banner">
            <div class="p-navigation__logo">
                <a class="p-navigation__link u-vertically-center p-link--logo" href="https://yukihane.github.io/">
                    発火後忘失
                </a>
            </div>
            
            <a href="#navigation" class="p-navigation__toggle--open" title="menu">
                <i class="p-icon--menu"></i>
            </a>
            <a href="#navigation-closed" class="p-navigation__toggle--close" title="close menu">
                <i class="p-icon--close"></i>
            </a>
        </div>

        <nav class="p-navigation__nav">
            <span class="u-off-screen">
                <a href="#main-content">Jump to main content</a>
            </span>

            <ul class="p-navigation__links" role="menu">
                
            </ul>

            
            <form class="p-search-box" action="https://www.google.com/search" target="_blank">
    <input type="search" class="p-search-box__input" name="q" placeholder='Search'
        required="" aria-label="Query">
    <input type="hidden" name="sitesearch" value="https://yukihane.github.io/">
    <button type="reset" class="p-search-box__reset" alt="reset" aria-label="Reset">
        <i class="p-icon--close"></i>
    </button>
    <button type="submit" class="p-search-box__button" alt="search" aria-label="Search">
        <i class="p-icon--search"></i>
    </button>
</form>
            
        </nav>
    </div>
</header><div id="main-content">
<header class="p-strip page-banner">
    <div class="row">
        <h1>rustでwasmでhello, world(2020-04-08版) の次</h1>
    </div>

    

<div class="row">

    
    <div class="col-8">
        




<div class="p-media-object">

    

    <div class="p-media-object__details">

        

        
        <p class="p-media-object__content">
            <span class="u-capitalized">on</span>
            2020-04-09
        </p>
        

    </div>
</div>


    </div>
    

    
    <div class="col-4  col--share-links ">
        <ul class="p-inline-list-icons p-inline-list-icons--share-links u-no-padding--left u-no-margin--left u-unselectable">
    <li class="p-inline-list__item">
        <i class="p-icon--share"></i>
    </li>
    <li class="p-inline-list__item">
        <a class="p-icon--facebook" title='Share on Facebook' target="_blank"
            rel="noreferrer" href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fyukihane.github.io%2fposts%2f202004%2f09%2fhello-wasm-next%2f">
            Facebook
        </a>
    </li>
    <li class="p-inline-list__item">
        <a class="p-icon--twitter" title='Share on Twitter' target="_blank"
            rel="noreferrer" href="http://twitter.com/share?text=rust%e3%81%a7wasm%e3%81%a7hello%2c%20world%282020-04-08%e7%89%88%29%20%e3%81%ae%e6%ac%a1&amp;url=https%3a%2f%2fyukihane.github.io%2fposts%2f202004%2f09%2fhello-wasm-next%2f">
            Twitter
        </a>
    </li>
    <li class="p-inline-list__item">
        <a class="p-icon--linkedin" title='Share on LinkedIn' target="_blank"
            rel="noreferrer"
            href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fyukihane.github.io%2fposts%2f202004%2f09%2fhello-wasm-next%2f&amp;title=rust%e3%81%a7wasm%e3%81%a7hello%2c%20world%282020-04-08%e7%89%88%29%20%e3%81%ae%e6%ac%a1">
            LinkedIn
        </a>
    </li>
</ul>
    </div>
    

</div>




<div class="row">
    <div class="col-12">
        
<a href="https://yukihane.github.io/tags/rust/">#rust</a>&ensp;

<a href="https://yukihane.github.io/tags/wasm/">#wasm</a>&ensp;

    </div>
</div>

</header>

<section class="p-strip is-shallow">
    <main class="row post-content">
        <h1 id="目標">目標</h1>
<p><a href="https://qiita.com/yukihane/items/66679cbe076f0bb3a962">rust で wasm で hello, world</a>の次として、JavaScript で実装されたプロジェクトを Rust に書き直してみます。</p>
<p>最近<a href="https://www.nnn.ed.nico/pages/programming/">N 予備校のプログラミング入門 Web アプリコース</a>を始めたのでそれを題材にします。</p>
<ul>
<li><a href="https://www.nnn.ed.nico/courses/668/chapters/9514">https://www.nnn.ed.nico/courses/668/chapters/9514</a></li>
</ul>
<p>このへんで作っているもので、完成版のコードは</p>
<ul>
<li><a href="https://github.com/progedu/assessment-for-download">https://github.com/progedu/assessment-for-download</a></li>
</ul>
<p>にあります。</p>
<h1 id="プロジェクト作成">プロジェクト作成</h1>
<p><a href="https://qiita.com/yukihane/items/66679cbe076f0bb3a962">前回</a>の通り。</p>
<pre><code>npm init rust-webpack assessment
cd assessment
</code></pre>
<h1 id="元ファイルコピー">元ファイルコピー</h1>
<pre><code>curl -L -o static/assessment.css https://raw.githubusercontent.com/progedu/assessment-for-download/master/assessment.css
curl -L -o static/assessment.html https://raw.githubusercontent.com/progedu/assessment-for-download/master/assessment.html
curl -L -o js/assessment.js https://raw.githubusercontent.com/progedu/assessment-for-download/master/assessment.js
</code></pre><h1 id="実行してみる">実行してみる</h1>
<p><code>assessmment.html</code> を開きたいので <code>webpack.config.js</code> に<a href="https://webpack.js.org/configuration/dev-server/#devserveropenpage">設定を追加</a>します:</p>
<pre><code>module.exports = {
  //...
  devServer: {
    openPage: '/assessment.html'
  }
};
</code></pre><p>編集がおわったらコマンド実行:</p>
<pre><code>yarn start
</code></pre>
<p>&ldquo;あなたのいいところ診断&quot;ページが表示されれば OK。ただし devtools の console を見ると <code>assessment.js</code> が読み込めていません。</p>
<h1 id="asessment関数を-rust-に移植"><code>asessment</code>関数を Rust に移植</h1>
<p><code>src/lib.rs</code>:</p>
<pre><code>const ANSWERS :[&amp;str;16] = [
  &quot;{userName}のいいところは声です。{userName}の特徴的な声は皆を惹きつけ、心に残ります。&quot;,
  &quot;{userName}のいいところはまなざしです。{userName}に見つめられた人は、気になって仕方がないでしょう。&quot;,
  &quot;{userName}のいいところは情熱です。{userName}の情熱に周りの人は感化されます。&quot;,
  &quot;{userName}のいいところは厳しさです。{userName}の厳しさがものごとをいつも成功に導きます。&quot;,
  &quot;{userName}のいいところは知識です。博識な{userName}を多くの人が頼りにしています。&quot;,
  &quot;{userName}のいいところはユニークさです。{userName}だけのその特徴が皆を楽しくさせます。&quot;,
  &quot;{userName}のいいところは用心深さです。{userName}の洞察に、多くの人が助けられます。&quot;,
  &quot;{userName}のいいところは見た目です。内側から溢れ出る{userName}の良さに皆が気を惹かれます。&quot;,
  &quot;{userName}のいいところは決断力です。{userName}がする決断にいつも助けられる人がいます。&quot;,
  &quot;{userName}のいいところは思いやりです。{userName}に気をかけてもらった多くの人が感謝しています。&quot;,
  &quot;{userName}のいいところは感受性です。{userName}が感じたことに皆が共感し、わかりあうことができます。&quot;,
  &quot;{userName}のいいところは節度です。強引すぎない{userName}の考えに皆が感謝しています。&quot;,
  &quot;{userName}のいいところは好奇心です。新しいことに向かっていく{userName}の心構えが多くの人に魅力的に映ります。&quot;,
  &quot;{userName}のいいところは気配りです。{userName}の配慮が多くの人を救っています。&quot;,
  &quot;{userName}のいいところはその全てです。ありのままの{userName}自身がいいところなのです。&quot;,
  &quot;{userName}のいいところは自制心です。やばいと思ったときにしっかりと衝動を抑えられる{userName}が皆から評価されています。&quot;
];

#[wasm_bindgen]
pub fn assessment(user_name: &amp;str) -&gt; String {
  let sum: u32 = user_name.chars().map(|x| x as u32).sum();
  let index = (sum % (ANSWERS.len() as u32)) as usize;

  ANSWERS[index].replace(&quot;{userName}&quot;, user_name)
}
</code></pre><h1 id="js-実装">js 実装</h1>
<p><code>assessment.js</code>という名前をそのまま使う方法がわからなかったので仕方なく <code>index.js</code> の方で実装しました。
<code>assessment</code>関数以外の部分をコピペして <code>assessment.js</code> は削除します。
ただし <code>assessment</code>関数は Rust 側で実装したものを呼び出すように変更します。</p>
<pre><code>import(&quot;../pkg/index.js&quot;).then(module =&gt; {
...
        const result = module.assessment(userName);
</code></pre><p>そして <code>assessment.html</code> は <code>assessment.js</code> でなく <code>index.js</code> を読むようにします。</p>
<pre><code>&lt;script src=&quot;index.js&quot;&gt;&lt;/script&gt;
</code></pre><p><code>index.html</code> は不要なので削除します。</p>
<h1 id="実行">実行</h1>
<p>編集は以上です。実行してみます:</p>
<pre><code>yarn start
</code></pre>
<p>配布するまでにはまだひと手間かかりそうだけれども、取り敢えずここまで。</p>
<h1 id="実装コード">実装コード</h1>
<ul>
<li><a href="https://github.com/yukihane/hello-js/tree/master/nnn.ed.nico/webapp-primer-2020-rust/assessment">https://github.com/yukihane/hello-js/tree/master/nnn.ed.nico/webapp-primer-2020-rust/assessment</a></li>
</ul>

    </main>
</section>

<footer class="p-strip is-wrapper">
    <div class="row">
        <div class="p-article-pagination">
    
    <a class="p-article-pagination__link--previous" href="https://yukihane.github.io/posts/202004/08/hello-wasm-with-rust/">
        <span class="p-article-pagination__label">Previous</span>
        <span class="p-article-pagination__title">
            Hello, Wasm with Rust
        </span>
    </a>
    

    
    <a class="p-article-pagination__link--next" href="https://yukihane.github.io/posts/202004/13/react-router/">
        <span class="p-article-pagination__label">Next</span>
        <span class="p-article-pagination__title">
            React Router &lt;Route&gt; で描画したいコンポーネントの指定方法が人によってまちまちなんだけどどれが正解なの？
        </span>
    </a>
    
</div>
    </div>
</footer>

        </div><footer class="p-strip is-shallow page-footer">
    <div class="row">
        <div class="col-12  u-align--center">
            <p>
                © 2020 発火後忘失
            </p>
        </div>
    </div>
</footer>




</body>
</html>
